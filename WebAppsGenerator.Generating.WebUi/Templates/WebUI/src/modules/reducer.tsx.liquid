import { Reducer } from 'redux';
import { {{ Params.Entity.Name }}ActionTypes } from './actionTypes';
import { {{ Params.Entity.Name }}Actions } from './actions';
import {{ Params.Entity.Name }} from '../../models/{{ Params.Entity.Name }}';


export interface I{{ Params.Entity.Name }}State {
    readonly isFetching: boolean,
    readonly isInvalid: boolean,
    readonly {{ Params.Entity.PluralName | DeCapitalize}}: {{ Params.Entity.Name }}[],
    readonly {{ Params.Entity.Name | DeCapitalize }}Id: number,
}

const initialState: I{{ Params.Entity.Name }}State = {
    isFetching: false,
    isInvalid: false,
    {{ Params.Entity.PluralName | DeCapitalize}}: [],
    {{ Params.Entity.Name | DeCapitalize }}Id: -1,
};

const {{ Params.Entity.Name | DeCapitalize}}Reducer: Reducer<I{{ Params.Entity.Name }}State, {{ Params.Entity.Name }}Actions> = (state = initialState, action: {{ Params.Entity.Name }}Actions) => {
    switch (action.type) {
        case {{ Params.Entity.Name }}ActionTypes.SELECT_{{ Params.Entity.Name | SnakeUppercase}}:
            return {
                ...state,
                {{ Params.Entity.Name | DeCapitalize }}Id: action.{{ Params.Entity.Name | DeCapitalize }}Id
            };
        case {{ Params.Entity.Name }}ActionTypes.REQUEST_UPDATE_{{ Params.Entity.Name | SnakeUppercase}}:
        case {{ Params.Entity.Name }}ActionTypes.REQUEST_DELETE_{{ Params.Entity.Name | SnakeUppercase}}:
        case {{ Params.Entity.Name }}ActionTypes.REQUEST_ADD_{{ Params.Entity.Name | SnakeUppercase}}:
        case {{ Params.Entity.Name }}ActionTypes.REQUEST_{{ Params.Entity.PluralName | SnakeUppercase }}:
            return {
                ...state,
                isFetching: true,
                isInvalid: false,
            };
        case {{ Params.Entity.Name }}ActionTypes.RESPONSE_UPDATE_{{ Params.Entity.Name | SnakeUppercase}}:
            return responseUpdate{{ Params.Entity.Name }}(state, action.{{ Params.Entity.Name | DeCapitalize }});
        case {{ Params.Entity.Name }}ActionTypes.RESPONSE_DELETE_{{ Params.Entity.Name | SnakeUppercase}}:
            return responseDelete{{ Params.Entity.Name }}(state, action.{{ Params.Entity.Name | DeCapitalize }}Id);
        case {{ Params.Entity.Name }}ActionTypes.RESPONSE_ADD_{{ Params.Entity.Name | SnakeUppercase}}:
            return responseAdd{{ Params.Entity.Name }}(state, action.{{ Params.Entity.Name | DeCapitalize }});
        case {{ Params.Entity.Name }}ActionTypes.RECEIVE_{{ Params.Entity.PluralName | SnakeUppercase }}:
            return {
                ...state,
                {{ Params.Entity.PluralName | DeCapitalize}}: action.{{ Params.Entity.PluralName | DeCapitalize}},
                isFetching: false
            };
        case {{ Params.Entity.Name }}ActionTypes.SET_ADD_{{ Params.Entity.Name | SnakeUppercase}}_ERROR:
        case {{ Params.Entity.Name }}ActionTypes.SET_UPDATE_{{ Params.Entity.Name | SnakeUppercase}}_ERROR:
        case {{ Params.Entity.Name }}ActionTypes.SET_DELETE_{{ Params.Entity.Name | SnakeUppercase}}_ERROR:
        case {{ Params.Entity.Name }}ActionTypes.SET_FETCH_ERROR_{{ Params.Entity.PluralName | SnakeUppercase }}:
            return {
                ...state,
                isInvalid: true
            };

        default:
            return state;
    }
}

const responseAdd{{ Params.Entity.Name }} = (state: I{{ Params.Entity.Name }}State, new{{ Params.Entity.Name }}: {{ Params.Entity.Name }}) => {
    const {{ Params.Entity.PluralName | DeCapitalize}} = state.{{ Params.Entity.PluralName | DeCapitalize}};
    {{ Params.Entity.PluralName | DeCapitalize}}.push(new{{ Params.Entity.Name }});
    return {
        ...state,
        isFetching: false,
        showToast: true,
        {{ Params.Entity.PluralName | DeCapitalize}}
    };
};

const responseDelete{{ Params.Entity.Name }} = (state: I{{ Params.Entity.Name }}State, id: number) => {
    const {{ Params.Entity.PluralName | DeCapitalize}} = state.{{ Params.Entity.PluralName | DeCapitalize}};
    const toDel = state.{{ Params.Entity.PluralName | DeCapitalize}}.find(c => c.id === id);
    if(toDel === undefined) {
        return state;
    }
	const index = {{ Params.Entity.PluralName | DeCapitalize}}.indexOf(toDel);
    {{ Params.Entity.PluralName | DeCapitalize}}.splice(index, 1);
    return {
        ...state,
        isFetching: false,
        showToast: true,
        {{ Params.Entity.PluralName | DeCapitalize}}
    };
};

const responseUpdate{{ Params.Entity.Name }} = (state: I{{ Params.Entity.Name }}State, new{{ Params.Entity.Name }}: {{ Params.Entity.Name }}) => {
    const {{ Params.Entity.PluralName | DeCapitalize}} = state.{{ Params.Entity.PluralName | DeCapitalize}};
    const old{{ Params.Entity.Name }} = state.{{ Params.Entity.PluralName | DeCapitalize}}.find(c => c.id === new{{ Params.Entity.Name }}.id);
    if(old{{ Params.Entity.Name }} === undefined) {
        return state;
    }
	const index = {{ Params.Entity.PluralName | DeCapitalize}}.indexOf(old{{ Params.Entity.Name }});
    {{ Params.Entity.PluralName | DeCapitalize}}[index] = new{{ Params.Entity.Name }};
    return {
        ...state,
        isFetching: false,
        showToast: true,
        {{ Params.Entity.PluralName | DeCapitalize}}
    };
};


export default {{ Params.Entity.Name | DeCapitalize}}Reducer;
import * as React from 'react';
import { bindActionCreators } from 'redux';
import { connect } from 'react-redux';
import * as Actions from '../../modules/{{ Params.Entity.Name | DeCapitalize }}/actions';
import GenericTable from '../GenericTable/GenericTable';
import {{ Params.Entity.Name }} from '../../models/{{ Params.Entity.Name }}';
import { IRootState } from '../../modules';


interface IStoreProps {
    {{ Params.Entity.PluralName | DeCapitalize }}: {{ Params.Entity.Name }}[],
    actions: any
	onSelect? : ((selected: {{ Params.Entity.IdField.Type.Name }}[]) => void);
    selected: {{ Params.Entity.IdField.Type.Name }}[]
}

interface I{{ Params.Entity.Name }}TableProps {
    showCheckboxes: boolean,
    multipleSelects: boolean
}

type ICombinedProps = IStoreProps & I{{ Params.Entity.Name }}TableProps;

class {{ Params.Entity.Name }}Table extends React.Component<ICombinedProps> {
    public componentDidMount() {
        this.props.actions.get{{ Params.Entity.PluralName }}();
    }
    public render() {
        const data = !this.props.{{ Params.Entity.PluralName | DeCapitalize }}? [] : this.props.{{ Params.Entity.PluralName | DeCapitalize }}.map(({{ Params.Entity.Name | DeCapitalize }}: {{ Params.Entity.Name }}) => ({
            {%- for field in Params.Entity.Fields -%}
				{%- if field.Type.IsSimpleType -%}
			{{ field.Name }}: {{ Params.Entity.Name | DeCapitalize }}.{{ field.Name }},
				{%- endif -%}
			{%- endfor -%}
        }));

        const tableHeadLabels = 
			[
				{%- for field in Params.Entity.Fields -%}
					{%- if field.Type.IsSimpleType -%}
				'{{ field.Name | Capitalize | SplitCamelCase }}',
					{%- endif -%}
				{%- endfor -%}
			];
		
        return (
            <GenericTable
                data={data}
                selected={this.props.selected}
                tableTitle="{{ Params.Entity.PluralName }}"
                tableHeadLabels={tableHeadLabels}
                showCheckboxes={true}
                multipleSelects={true}
				onSelect={this.props.onSelect}
            />
        )
    }
}

const mapStateToProps = (state: IRootState, ownProps: I{{ Params.Entity.Name }}TableProps) => ({
    {{ Params.Entity.PluralName | DeCapitalize }}: state.{{ Params.Entity.Name | DeCapitalize }}.{{ Params.Entity.PluralName | DeCapitalize }},
    ...ownProps
});

const mapDispatchToProps = (dispatch: any) => ({
    actions: bindActionCreators(Actions, dispatch),
});
export default connect(mapStateToProps, mapDispatchToProps)({{ Params.Entity.Name }}Table);

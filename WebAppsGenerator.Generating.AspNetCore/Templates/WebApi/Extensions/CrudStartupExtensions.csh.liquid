using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.DependencyInjection;
using {{Params.CoreProjectName}}.Context;
using {{Params.CoreProjectName}}.Models;
using {{Params.CoreProjectName}}.Interfaces;
using {{Params.CoreProjectName}}.Services;
using {{Params.CoreProjectName}}.Services.Generated;

namespace {{Params.WebApiProjectName}}.Extensions
{
	/// <summary>
    /// Autogenerated.
    /// </summary>
    public static class CrudStartupExtensions
    {
		public static IServiceCollection AddDbServices(this IServiceCollection services)
        {
			services.AddScoped(typeof(IRepository<,>), typeof(DbRepository<,>));
			services.AddScoped<RepositorySet>();
			services.AddScoped<ITransactionScopeFactory, DbTransactionScopeFactory>();

			return services;
		}
        public static IServiceCollection AddGeneratedCrudServices(this IServiceCollection services)
        {
			{%- for entity in Params.Entities -%}
			services.AddScoped<ICrudService<{{entity.Name}}, {{entity.IdField.Type.Name}}>, {{entity.Name}}CrudService>();
			{%- endfor -%}

			return services;
        }
    }
}
